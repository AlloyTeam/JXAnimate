<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jx/jx.ui.scrollbar.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JXAnimation.Audio.html">JXAnimation.Audio</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Tab.html">Tab</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/JXAnimate.Audio.html">JXAnimate.Audio</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: jx/jx.ui.scrollbar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

 Jx().$package(function (J) {
     var $D = J.dom,
         $E = J.event;
        
    J.ui = J.ui || {};
    /**
     * 自定义滚动条
     * @class
     * @constructor
     * @memberOf ui
     * @name ScrollBar
     * @param {HTMLElement} el 需要生成滚动条的div(至少保证有一个子div，存放需要滚动的内容)
     * @param {Object} option
     * option.onscroll||function(){};&lt;br/&gt;
       option.scrollToBottom||function(){};&lt;br/&gt;
       option.ipadTouchArea||false;&lt;br/&gt;
     * @example 
     * &lt;div id =&quot;scroll&quot;&gt;&lt;div id=&quot;scrollcontent&quot;&gt;&lt;/div&gt;&lt;/div&gt;
     * scroll与scrollcontent的position必须为relative|absolute
     * (可选: 会用js强制设置)scrollcontent的高度为100%, overflow:hidden
     */
    J.ui.ScrollBar = new J.Class(
    /**
     * @lends ui.ScrollBar.prototype
     */
    {
        option: {
            &#x27;barClass&#x27;: &#x27;scrollBar&#x27;,
            &#x27;barHoverClass&#x27;: null,
            &#x27;barActiveClass&#x27;: null,
            &#x27;showBarContainer&#x27;: false
        },
        /**
         * @ignore
         */
        init: function(el,option) {
            
            var self = this;
            J.extend(this.option, option);
            this.bar = $D.node(&#x27;div&#x27;,{
                &#x27;class&#x27;:option.scrollBarClassName||&#x27;scrollBar&#x27; 
            });
            this.obj = el;
            this.content = this.obj.getElementsByTagName(&#x27;div&#x27;)[0] || this.obj;
            $D.setStyle(this.content, &#x27;height&#x27;, &#x27;100%&#x27;);
            $D.setStyle(this.content, &#x27;overflow&#x27;, &#x27;hidden&#x27;);

            //兼容ie圆角
            if(J.browser.ie){
                this.bar.innerHTML = &#x27;&lt;div class=&quot;scrollBar_bg scrollBar_bg_t&quot;&gt;&lt;/div&gt;&lt;div class=&quot;scrollBar_bg scrollBar_bg_b&quot;&gt;&lt;/div&gt;&#x27;;
            }
            this.onscroll= option.onscroll||function(){};
            this.scrollToBottom= option.scrollToBottom||function(){};
            this.ipadTouchArea= option.ipadTouchArea||false;
            $D.setStyle(this.bar, &#x27;marginTop&#x27;, 0);
            this.obj.appendChild(this.bar);
            
            //滚动槽
            if(option.showBarContainer){
                this.barBc = $D.node(&#x27;div&#x27;,{
                    &#x27;class&#x27;:&#x27;scrollBar_bgc&#x27;
                });
                if(J.browser.ie){
                    this.barBc.innerHTML = &#x27;&lt;div class=&quot;scrollBar_bgc_c scrollBar_bgc_t&quot;&gt;&lt;/div&gt;&lt;div class=&quot;scrollBar_bgc_c scrollBar_bgc_b&quot;&gt;&lt;/div&gt;&#x27;;
                }
                this.obj.appendChild(this.barBc);
            }
            
            this.setBarHeight();
            this.bar.y;
            this.srcElement;
            this.marginTop;
            this.D; //鼠标滚动方向
            this.wheelThread = 20; //滚动20px
            this.isScrolling = false;
            
            var observer = {
                /** @ignore */
                onMouseDown:function(e){
                    //e.preventDefault();
                    var target = e.target;
                    if(e.changedTouches) {
                        e= e.changedTouches[0];
                    }
                    self.bar.y = e.clientY;
                    self.bar.t = parseInt( self.bar.style.marginTop );
                    if(!J.platform.iPad){
                        $E.on(document, &#x27;mousemove&#x27;, observer.onMouseMove);
                        $E.on(document, &#x27;mouseup&#x27;, observer.onMouseUp);
                        e.stopPropagation();
                    }else {
                        if(target == self.bar){
                            $E.on(document, &#x27;touchmove&#x27;, observer.onMouseMove);
                            $E.on(document, &#x27;touchend&#x27;, observer.onBarMouseUp);
                        }else{
                            $E.on(document, &#x27;touchmove&#x27;, observer.onTouchAreaMove);
                            $E.on(document, &#x27;touchend&#x27;, observer.onMouseUp);
                        }
                    }
                    self.isScrolling = true;
                    if(self.option.barActiveClass)
                        $D.addClass(self.bar, self.option.barActiveClass);
                },
                /** @ignore */
                onMouseMove:function(e){
                    if(e.changedTouches) {
                        e.preventDefault();
                        e= e.changedTouches[0];
                    }
                    self.scroll( e.clientY - self.bar.y );
                    if(!J.platform.iPad) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                },
                /** @ignore */
                onTouchAreaMove:function(e){
                    e.preventDefault();
                    e.stopPropagation();
                    if(e.changedTouches) {
                        e= e.changedTouches[0];
                    }
                    self.scroll( - e.clientY + self.bar.y );
                    //if(!J.platform.iPad) {
                    //}
                },
                /** @ignore */
                onBarMouseUp:function(e){
                    if(!J.platform.iPad){
                        $E.off(document, &#x27;mousemove&#x27;, observer.onMouseMove);
                        $E.off(document, &#x27;mouseup&#x27;, observer.onMouseUp);
                    }else {
                        $E.off(document, &#x27;touchmove&#x27;, observer.onMouseMove);
                        $E.off(document, &#x27;touchend&#x27;, observer.onBarMouseUp);
                    }
                    self.isScrolling = false;
                    if(self.option.barActiveClass)
                        $D.removeClass(self.bar, self.option.barActiveClass);
                },
                /** @ignore */
                onMouseUp:function(e){
                    if(!J.platform.iPad){
                        $E.off(document, &#x27;mousemove&#x27;, observer.onMouseMove);
                        $E.off(document, &#x27;mouseup&#x27;, observer.onMouseUp);
                    }else {
                        $E.off(document, &#x27;touchmove&#x27;, observer.onTouchAreaMove);
                        $E.off(document, &#x27;touchend&#x27;, observer.onMouseUp);
                    }
                    self.isScrolling = false;
                    if(self.option.barActiveClass)
                        $D.removeClass(self.bar, self.option.barActiveClass);
                },
                /** @ignore */
                onMouseOver: function(e){
                    $D.addClass(self.bar, self.option.barHoverClass);
                },
                /** @ignore */
                onMouseOut: function(e){
                    $D.removeClass(self.bar, self.option.barHoverClass);
                },
                /** @ignore */
                onMouseWheel:function(event){
                    if(!$D.isShow(self.bar)) {
                        self.scrollToBottom(event);
                        return;
                    }
                    self.D = event.wheelDelta;
                    event.returnValue = false;
                    var _y = (self.D &lt; 0) ? self.wheelThread : (0-self.wheelThread);
                    self.bar.y = event.clientY;
                    self.bar.t = parseInt( self.bar.style.marginTop );
//                    var mul = self.content.scrollHeight/parseInt(self.bar.style.height)/5;
//                    if(mul&lt;1){
//                        mul = 1;
//                    }
//                    _y *= mul;
                    self.scroll(_y);
                },
                /** @ignore */
                onClick:function(e){
                    e.stopPropagation();
                },
                /** @ignore */
                onDomMouseScroll:function(e){
                    if(!$D.isShow(self.bar)) {
                        self.scrollToBottom(e);
                        return;
                    }
                    self.D = (e.detail &gt; 0) ? -1 : 1;
                    if(!J.platform.iPad){
                        e.stopPropagation();
                        e.preventDefault();
                    }
                    self.bar.y = e.clientY;
                    self.bar.t = parseInt( self.bar.style.marginTop );
                    var _y = (self.D &lt; 0) ? self.wheelThread : (0-self.wheelThread);
//                    var mul = self.content.scrollHeight/parseInt(self.bar.style.height)/5;
//                    if(mul&lt;1){
//                        mul = 1;
//                    }
//                    _y *= mul;
                    self.scroll(_y);
                }
            };
            
            if(this.option.stopClick){
                $E.on(this.bar, &#x27;click&#x27;, observer.onClick);
            }
            if(this.option.barHoverClass){
                $E.on(this.bar, &#x27;mouseover&#x27;, observer.onMouseOver);
                $E.on(this.bar, &#x27;mouseout&#x27;, observer.onMouseOut);
            }
            if(J.platform.iPad) {
                $E.on(this.bar, &#x27;touchstart&#x27;, observer.onMouseDown);
                if(this.ipadTouchArea) {
                    $E.on(this.content, &#x27;touchstart&#x27;, observer.onMouseDown);
                }
            }else {
                $E.on(this.bar, &#x27;mousedown&#x27;, observer.onMouseDown);
                //滚动事件兼容 参照jquery mousewheel
                if (J.browser.ie || J.browser.engine.webkit || J.browser.opera) {
                    $E.on(this.content, &#x27;mousewheel&#x27;, observer.onMouseWheel);
                    $E.on(this.bar, &#x27;mousewheel&#x27;, observer.onMouseWheel);
                } else {
                    $E.on(this.content, &#x27;DOMMouseScroll&#x27;, observer.onDomMouseScroll);
                    $E.on(this.bar, &#x27;DOMMouseScroll&#x27;, observer.onDomMouseScroll);
                }
            }
        },
        /**
         * 滚动条回到顶部
         */
        scrollBack: function() {
            var self= this;
            self.content.scrollTop = &quot;0px&quot;;
            self.bar.t= 0;
            self.scroll(0);
        },
        /**
         * 刷新滚动条, 同 update
         */
        refresh: function(){
            //跟iscroll同名接口
            this.update();  
        },
        /**
         * 刷新滚动条
         */
        update: function(){
            this.setBarHeight();
        },
        /**
         * 计算滚动条位置
         * @private
         */
        setBarHeight: function(){
            
            var self = this;
            
            self.onscroll(0,0); //防止影响scrollHeight计算
            self.bar.style[&#x27;height&#x27;]=&#x27;0&#x27;; //防止影响scrollHeight计算
            
            $D.hide(self.bar); //防止影响scrollHeight计算
            
            if((self.content.offsetHeight - self.content.scrollHeight) &gt;= 0 ){
                if(self.barBc){
                    $D.hide(self.barBc);
                }
                self.bar.t = 0; //滚动条复位
            }else{
                self.bar.style.height = parseInt(self.content.offsetHeight / self.content.scrollHeight * self.content.offsetHeight) + &#x27;px&#x27;;
                $D.show(self.bar);
                if(self.barBc){
                    $D.show(self.barBc);
                }
                self.bar.t = parseInt( self.bar.style.marginTop );
            }
            //触发scroll事件，重置滚动条位置，滚动距离为0
            self.scroll(0);
        },
        /**
         * 移动滚动条，dis为滚动条移动距离
         * @param {Number} dis 
         */
        scroll: function(dis){
            var self = this;
            self.marginTop = (self.bar.t||0) + dis;
            if( self.marginTop &lt; 0 ) {
                self.marginTop = 0;
            }
            if( self.marginTop &gt; self.content.clientHeight - self.bar.offsetHeight ){
                self.marginTop = self.content.clientHeight - self.bar.offsetHeight;
                //到底通知
                self.scrollToBottom();
            }else {
                
            }
            self.bar.style.marginTop = self.marginTop + &#x27;px&#x27;;
            if(dis==0) {
                self.onscroll(dis,dis);
            }
            var scrollTop= ( self.content.scrollHeight - self.content.offsetHeight ) * parseInt( self.marginTop ) / ( self.content.offsetHeight - self.bar.offsetHeight );
            self.content.scrollTop = scrollTop;
            self.onscroll(scrollTop,dis);
            
        },
        /**
         * 获取当前滚动条的位置
         * @return {Number}
         */
        getScrollTop : function(){
          return  parseInt(this.content.scrollTop);
        },
        /**
         * 移动面板内容，dis为面板移动距离
         * @param {Number} dis 
         */
        contentScroll: function(dis){
            var self = this;
            var dis = parseInt(self.obj.offsetHeight / self.content.scrollHeight * dis);
            this.scroll(dis);
        },
        /**
         * 获取当前内容区的滚动位置
         * @return {Number}
         */
        contentPosition: function() {
            return this.content.scrollTop;
        }
    });
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
