<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jx/jx.ui.scrollarea.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JXAnimation.Audio.html">JXAnimation.Audio</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Tab.html">Tab</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/JXAnimate.Audio.html">JXAnimate.Audio</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: jx/jx.ui.scrollarea.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * 自定义滚动条
 * ippan
 * 前置条件：所传进来的div的positon必须为relative或absolute
 * 此方法会给div增加一个子元素（滚动条）
 */
 Jx().$package(function (J) {
     var $D = J.dom,
         $E = J.event;
    var doc;
    J.ui = J.ui || {};
    /**
     * 
     */
    J.ui.ScrollArea = new J.Class({
        init: function(el,_doc) {
            var self = this;
            doc = _doc ? _doc:document;
            this.container = el;
            this.scrollBar = doc.createElement(&#x27;div&#x27;);
            this.scrollBar.className = &#x27;scrollBar&#x27;;
            if(J.browser.ie){
                this.scrollBar.innerHTML = &#x27;&lt;div class=&quot;scrollBar_bg scrollBar_bg_t&quot;&gt;&lt;/div&gt;&lt;div class=&quot;scrollBar_bg scrollBar_bg_b&quot;&gt;&lt;/div&gt;&#x27;;
            }
            this.container.appendChild(this.scrollBar);
            this.wheelThread = 20; //滚动20px
            this.isScrolling = false;
            var scrollBarStartY;
            var observer = {
                onMouseDown:function(e){
                    e.preventDefault();
                    e.stopPropagation();
                    self.isScrolling = true;
                    scrollBarStartY = e.clientY;
                    $D.addClass(self.scrollBar, &#x27;active&#x27;);
                    $E.on(doc, &#x27;mousemove&#x27;, observer.onMouseMove);
                    $E.on(doc, &#x27;mouseup&#x27;, observer.onMouseUp);
                },
                onMouseMove:function(e){
                    var dy =  e.clientY - scrollBarStartY;
                    var scrollY = dy/(self.offsetHeight-self.scrollBarHeight) * (self.scrollHeight - self.offsetHeight);
                    self.scroll(scrollY);
                    scrollBarStartY = e.clientY;
                    e.preventDefault();
                    e.stopPropagation();
                },
                onClick:function(e){
                    e.preventDefault();
                    e.stopPropagation();
                },
                onMouseUp:function(e){
                    e.preventDefault();
                    e.stopPropagation();
                    $E.off(doc, &#x27;mousemove&#x27;, observer.onMouseMove);
                    $E.off(doc, &#x27;mouseup&#x27;, observer.onMouseUp);
                    self.isScrolling = false;
                    $D.removeClass(self.scrollBar, &#x27;active&#x27;);
                },
                onMouseOver: function(e){
                    $D.addClass(self.scrollBar, &#x27;hover&#x27;);
                },
                onMouseOut: function(e){
                    $D.removeClass(self.scrollBar, &#x27;hover&#x27;);
                },
                onMouseWheel:function(event){
                    if(!$D.isShow(self.scrollBar)) return;
                    var delta = event.wheelDelta;
                    event.returnValue = false;
                    var _y = (delta &lt; 0) ? self.wheelThread : (0-self.wheelThread);
                    var mul = self.scrollHeight/self.scrollBarHeight/5;
                    if(mul&lt;1){
                        mul = 1;
                    }
                    _y *= mul;
                    self.scroll(_y);
                },
                onDomMouseScroll:function(e){
                    if(!$D.isShow(self.scrollBar)) return;
                    var delta = (e.detail &gt; 0) ? -1 : 1;
                    e.stopPropagation();
                    e.preventDefault();
                    var _y = (delta &lt; 0) ? self.wheelThread : (0-self.wheelThread);
                    var mul = self.scrollHeight/self.scrollBarHeight/5;
                    if(mul&lt;1){
                        mul = 1;
                    }
                    _y *= mul;
                    self.scroll(_y);
                }
            };
            this.observer = observer;
            $E.on(this.scrollBar, &#x27;mousedown&#x27;, observer.onMouseDown);
            $E.on(this.scrollBar, &#x27;click&#x27;, observer.onClick);
            $E.on(this.scrollBar, &#x27;mouseover&#x27;, observer.onMouseOver);
            $E.on(this.scrollBar, &#x27;mouseout&#x27;, observer.onMouseOut);
            
            //滚动事件兼容 参照jquery mousewheel
            if (J.browser.ie || J.browser.engine.webkit || J.browser.opera) {
                $E.on(this.container, &#x27;mousewheel&#x27;, observer.onMouseWheel);
                $E.on(this.scrollBar, &#x27;mousewheel&#x27;, observer.onMouseWheel);
            } else {
                $E.on(this.container, &#x27;DOMMouseScroll&#x27;, observer.onDomMouseScroll);
                $E.on(this.scrollBar, &#x27;DOMMouseScroll&#x27;, observer.onDomMouseScroll);
            }
            this.update();
        },
        update: function(){
            if(this.updateTimer){
                return;
            }
            var that=this;
            this.updateTimer = setTimeout(function(){
                that.updateTimer = 0;
                that.scrollBar.style[&#x27;height&#x27;]=&#x27;0&#x27;;//防止scrollBar的高度影响区域高度计算
                $D.hide(that.scrollBar);
                that.scrollHeight = that.container.scrollHeight;
                that.offsetHeight = that.container.offsetHeight;
                that.scrollBarHeight = that.offsetHeight/that.scrollHeight*that.offsetHeight;
                //console.info(that.scrollBarHeight,that.scrollHeight,that.offsetHeight);
                if(that.scrollHeight &lt;= that.offsetHeight){
                    //J.out(&#x27;hide&#x27;);
                    //that.scrollBar.style[&#x27;display&#x27;]=&#x27;none&#x27;;
                }else{
                    //J.out(&#x27;show&#x27;);
                    $D.show(that.scrollBar);
                    if(that.scrollBarHeight &lt; 30){
                        that.scrollBarHeight = 30;
                    }
                    that.scrollBar.style[&#x27;height&#x27;] = that.scrollBarHeight+&#x27;px&#x27;;
                    that.scrollBar.style[&#x27;top&#x27;] = that.container.scrollTop+that.container.scrollTop/(that.scrollHeight-that.offsetHeight)*(that.offsetHeight-that.scrollBarHeight)+&#x27;px&#x27;;
                    //J.out(that.scrollHeight+&#x27; :: &#x27;+that.offsetHeight+&#x27; &#x27;+that.scrollTime);
                }
                //J.out(that.scrollHeight+&#x27; &#x27;+that.offsetHeight+&#x27; &#x27;+that.scrollTime);
            },500);
            //console.info(scrollHeight,offsetHeight,this.scrollBarHeight);
        },
        //@param dis 移动滚动条，dis为滚动条移动距离
        scroll: function(dis){
            var maxDis = this.scrollHeight - (this.container.scrollTop + this.offsetHeight);
            if(dis &gt; maxDis){
                dis = maxDis;
            }
            //J.out(this.container.scrollTop + this.offsetHeight+&#x27;  &#x27;+this.scrollHeight);
            var scrollTop = this.container.scrollTop+dis;
            this.scrollBar.style[&#x27;top&#x27;] = scrollTop+scrollTop/(this.scrollHeight-this.offsetHeight)*(this.offsetHeight-this.scrollBarHeight)+&#x27;px&#x27;;
            this.container.scrollTop = scrollTop;
        },
        getScrollTop : function(){
          return  parseInt(this.container.scrollTop);
        },
        destroy:function(){
            $E.off(this.scrollBar, &#x27;mousedown&#x27;, this.observer.onMouseDown);
            $E.off(this.scrollBar, &#x27;mouseover&#x27;, this.observer.onMouseOver);
            $E.off(this.scrollBar, &#x27;mouseout&#x27;, this.observer.onMouseOut);
            
            //滚动事件兼容 参照jquery mousewheel
            if (J.browser.ie || J.browser.engine.webkit || J.browser.opera) {
                $E.off(this.container, &#x27;mousewheel&#x27;, this.observer.onMouseWheel);
                $E.off(this.scrollBar, &#x27;mousewheel&#x27;, this.observer.onMouseWheel);
            } else {
                $E.off(this.container, &#x27;DOMMouseScroll&#x27;, this.observer.onDomMouseScroll);
                $E.off(this.scrollBar, &#x27;DOMMouseScroll&#x27;, this.observer.onDomMouseScroll);
            }
            this.container.removeChild(this.scrollBar);
            this.container = null;
            this.scrollBar = null;
        }
    });
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
