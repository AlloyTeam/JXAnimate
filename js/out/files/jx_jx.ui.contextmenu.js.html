<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jx/jx.ui.contextmenu.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/JXAnimation.Audio.html">JXAnimation.Audio</a></li>
            
                <li><a href="../classes/Log.html">Log</a></li>
            
                <li><a href="../classes/Tab.html">Tab</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/JXAnimate.Audio.html">JXAnimate.Audio</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: jx/jx.ui.contextmenu.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/* == J.ui.ContextMenu =============================================
 * Copyright (c) 2011, Tencent.com All rights reserved.
 * version: 1.0
 * rehorn
 * -------------------------------------------- 2011-1-18 ----- */
 
 
 Jet().$package(function (J) {
    var $D = J.dom,
        $S = J.string,
        $E = J.event;
    
    var startId = 0,
        topZIndex = 9000000;
    
    var flashItemId = 0;
    var contextHash = {};
    var flashItemHash = {};
    
    var onSelfContextMenu = function(e){
        e.preventDefault();
        e.stopPropagation();
    };
    var stopPropagation = function(e){
        e.stopPropagation();
    };
    J.ui = J.ui || {};
    
    /**
     * 【ContextMenu】
     * 
     * @memberOf ui
     * @name ContextMenu
     * @class
     * @constructor
     * @param {Object} option 构造参数
     * {
     * id: &#x27;&#x27;,//random
     * name: id,
     * container: document.body,
     * className: &#x27;&#x27; ,
     * width: null,
     * triggerEvent: &#x27;contextmenu&#x27;,
     * triggers: null,//HTMLElement数组 ,触发右键菜单的dom
     * items: []
     * }
     * 
     * @since version 1.0
     * @description
     * triggers 参数是指触发右键菜单显示的dom,
     * 右击该节点就显示菜单
     * 也可以不使用这个属性, 调用的地方自己控制显示隐藏菜单
     */
    var ContextMenu = J.ui.ContextMenu = new J.Class(
    /**
     * @lends ui.ContextMenu.prototype
     */
    {
        /**
         * @ignore
         */
        init: function (option){
            var context = this;
            var id = this.id = &#x27;context_menu_&#x27; + (option.id || (startId++));
            var name = option.name || id;
            var parent = this._parent = option.container || (option.parentMenu ? option.parentMenu._parent : null) || document.body;
            var className = option.className || &#x27;&#x27;;
            this.parentMenu = option.parentMenu;
            var context = this;
            var container = this._el = $D.id(id) || $D.node(&#x27;div&#x27;, {
                id: id,
                &#x27;class&#x27;: &#x27;context_menu&#x27;,
                style: &#x27;display: none;&#x27;
            });
            var html = &#x27;&lt;div class=&quot;context_menu_container &quot;&#x27; + className + &#x27;&quot;&gt;&lt;ul id=&quot;&#x27;+ id +&#x27;_body&quot; class=&quot;context_menu_item_list&quot;&gt;&lt;/ul&gt;&lt;/div&gt;&#x27;;
//                html += &#x27;&lt;div class=&quot;context_menu_outer_r&quot;&gt;&lt;/div&gt;&lt;div class=&quot;context_menu_outer_b&quot;&gt;&lt;/div&gt;&#x27;
//                + &#x27;&lt;div class=&quot;context_menu_outer_rt&quot;&gt;&lt;/div&gt;&lt;div class=&quot;context_menu_outer_rb&quot;&gt;&lt;/div&gt;&lt;div class=&quot;context_menu_outer_lb&quot;&gt;&lt;/div&gt;&#x27;;
            
            if(J.browser.ie){//遮ie的flash
                html += &#x27;&lt;iframe class=&quot;context_menu_iframe&quot; src=&quot;&#x27;+alloy.CONST.MAIN_URL+&#x27;domain.html&quot;&gt;&lt;/iframe&gt;&#x27;;
            }
            container.innerHTML = html;
            parent.appendChild(container);
            
            if(option.width){
                $D.setStyle(container, &#x27;width&#x27;, option.width + &#x27;px&#x27;);
            }
            this._body = $D.id(id + &#x27;_body&#x27;);
            $E.off(container, &#x27;contextmenu&#x27;);//防止绑定多个事件
            $E.on(container, &#x27;contextmenu&#x27;, onSelfContextMenu);
            $E.addObserver(document, &#x27;beforeStart&#x27;, function(){
                if(context.isShow()){
                    context.hide();
                }
            });
            this._popupBox = new J.ui.PopupBox({
                id: id,
                name: name,
                noCatchMouseUp: true,
                parentPopupBox: this.parentMenu ? this.parentMenu._popupBox : null,
                container: container
            });
            $E.addObserver(this._popupBox, &#x27;hide&#x27;, function(){
                context.hideSubmenu();
                $E.notifyObservers(context, &#x27;onHide&#x27;);
            });
            
            this.setZIndex(topZIndex);
            this._itemArr = [];
            this._key2Item = {};
            if(option.items){
                this._items_config= option.items;
                this.addItems(option.items);
            }
            if(option.triggers){
                var evnet = option.triggerEvent || &#x27;contextmenu&#x27;;
                /**
                 * @ignore
                 */
                var onTriggerContextMenu = function(e){
                    e.preventDefault();
                    context.show(e.clientX, e.clientY);
                };
                for(var i = 0, t; t = option.triggers[i]; i++){
//                    $E.off(t, &#x27;contextmenu&#x27;);//这里没必要
                    $E.on(t, evnet, onTriggerContextMenu);
                }
            }
            if(option.beforeShow){
                $E.addObserver(this, &#x27;BeforeShow&#x27;, option.beforeShow);
            }
            contextHash[id] = this;
        },
        /**
         * 获取改菜单的id
         */
        getId: function(){
            return this.id;
        },
        /**
         * 设置菜单的css类
         */
        setClass: function(className){
            $D.setClass(this._el, &#x27;context_menu &#x27; + className);
        },
        /**
         * 添加菜单项
         * @param {Object} option 
         * {&lt;br/&gt;
         *  title: 鼠标tips&lt;br/&gt;
            text: 菜单项的文字&lt;br/&gt;
            link: 指向链接&lt;br/&gt;
            icon: 图标的配置{ url, style, className }&lt;br/&gt;
            enable: 是否启用&lt;br/&gt;
            onClick: 点击处理函数&lt;br/&gt;
            argument: 点击处理函数接收的额外参数&lt;br/&gt;
         * }
         */
        addItem: function(option){
            var type = option.type || &#x27;item&#x27;;
            var item;
            option.parentMenu = this;
            switch(type){
            case &#x27;item&#x27;: 
                item = new ContextMenuItem(option);
                break;
            case &#x27;flash&#x27;: 
                item = new FlashContextMenuItem(option);
                break;
            case &#x27;separator&#x27;:
                item = new ContextMenuSeparator(option);
                break;
            case &#x27;submenu&#x27;:
                option.parentMenu = this;
                item = new ContextSubmenuItem(option);
                break;
            default:
                item = null;
                break;
            }
            if(item){
                this._body.appendChild(item.getElement());
                this._itemArr.push(item);
            }
        },
        /**
         * 批量添加菜单项
         * @param {Array} optionArray
         * @see ui.ContextMenu#addItem
         */
        addItems: function(optionArray){
            for(var i = 0, len = optionArray.length; i &lt; len; i++){
                this.addItem(optionArray[i]);
            }
        },
        /**
         * 刷新, 重回菜单
         */
        refresh: function() {
            if(this._items_config) {
                this.clearItems();
                this.addItems(this._items_config);
            }
        },
        /**
         * 清空所有菜单项
         */
        clearItems: function(){
            var item = this._itemArr.shift();
            while(item){
                this._body.removeChild(item.getElement());
                item.destory();
                item = this._itemArr.shift();
            }
        },
        /**
         * 移除指定下标的菜单项
         * @param {Number} index
         */
        removeItemAt: function(index) {
            for(var i=0; i&lt; this._itemArr.length;i++) {
                var item= this._itemArr[i];
                if(index==i &amp;&amp; item) {
                    this._body.removeChild(item.getElement());
                    item.destory();
                    this._itemArr.splice(i,1);
                }
            }
        },
        /**
         * 获取指定下标的菜单项
         * @param {Number} index
         * @return {ContextMenuItem}, {ContextSubmenuItem}, {ContextMenuSeparator}
         */
        getItemAt: function(index){
            if(index &lt; this._itemArr.length){
                if(index &lt; 0){
                    index = this._itemArr.length + index;
                }
                return this._itemArr[index];
            }else{
                return null;
            }
        },
        /**
         * 获取菜单本身的dom
         * @return {HTMLElement}
         */
        getElement: function(){
            return this._el;
        },
        /**
         * 获取菜单主体的dom
         * @return {HTMLElement}
         */
        getBody: function(){
            return this._body;
        },
        /**
         * 设置菜单的层级
         * @param {Number} zIndex
         * 
         */
        setZIndex: function(zIndex){
            this._popupBox.setZIndex(zIndex);
        },
        /**
         * 获取菜单的层级
         * @return {Number}
         */
        getZIndex: function(zIndex){
            return this._popupBox.getZIndex();  
        },
        /**
         * 这两个方法可以用来保存临时数据,
         * show之前保存, 供给item的回调使用
         * @param {Object} arg
         */
        setArgument: function(arg){
            this._argument = arg;
        },
        /**
         * @return {Object}
         */
        getArgument: function(){
            return this._argument;
        },
        /**
         * 显示菜单
         * @param {Number} x
         * @param {Number} y
         * @param {Number} offset 菜单位置相对于给定xy的偏移, 0为不偏移
         * @param {HTMLElement} relativeEl 相对某一元素定位
         */
        show: function(x, y, offset, relativeEl){
            $E.notifyObservers(this, &#x27;BeforeShow&#x27;, this);
            var x = x || 0,
                y = y || 0,
                offset = typeof(offset) === &#x27;undefined&#x27; ? 5 : offset;
            var popup = this._popupBox;
            var px = x + offset,
                py = y + offset;
            var rw = 0, rh = 0, ie = J.browser.ie;
            if(relativeEl){
                rw = $D.getOffsetWidth(relativeEl);
                rh = $D.getOffsetHeight(relativeEl);
                px += rw + 5;
                py -= 1;
                if(ie == 9 || ie == 8){
                    px += 2;
                }
            }
            popup.setX(&#x27;-10000&#x27;);
            popup.show();
            var w = $D.getClientWidth(this._el),
                h = $D.getClientHeight(this._el),
                bodyWidth = $D.getClientWidth(),
                bodyHeight = $D.getClientHeight();
            if(px + w &gt; bodyWidth &amp;&amp; x - w - offset &gt; 0){
                if(rw){
                    px = x - w - offset - 5;
                    if(ie == 9 || ie == 8){
                        px += 2;
                    }
                }else{
                    px = x - w - offset;
                }
            }
            if(py + h &gt; bodyHeight &amp;&amp; y - h - offset &gt; 0){
                if(rh){
                    py = y - h - offset + rh + 1;
                }else{
                    py = y - h - offset;
                }
            }
            popup.setXY(px, py);
            $E.notifyObservers(this, &#x27;onShow&#x27;, this);
        },
        /**
         * 隐藏菜单
         */
        hide: function(){
            this._popupBox.hide();
            $E.notifyObservers(this, &#x27;onHide&#x27;, this);
        },
        /**
         * 隐藏所有子菜单
         */
        hideSubmenu: function(){
            for(var i in this._itemArr){
                if(this._itemArr[i].getSubmenu){
                    this._itemArr[i].getSubmenu().hide();
                }
            }
        },
        /**
         * 指示菜单是否显示
         * @return {Boolean}
         */
        isShow: function(){
            return this._popupBox.isShow();
        },
        /**
         * 销毁菜单
         */
        destory: function(){
            this._el.innerHTML = &#x27;&#x27;;
            $E.off(this._el, &#x27;contextmenu&#x27;);
            this.clearItems();
            for (var p in this) {
                if (this.hasOwnProperty(p)) {
                    delete this[p];
                }
            }
        }
        
    });
    
    /**
     * 获取给定id的菜单, 无则返回null
     * @static
     * @function
     * @memberOf ui.ContextMenu
     * @name getMenu
     * @return {ui.ContextMenu},{Null}
     */
    ContextMenu.getMenu = function(id){
        return contextHash[id];
    };
    
    /**
     * 【ContextMenuItem】菜单项
     * @see ui.ContextMenu
     * 
     * @class 
     * @name ContextMenuItem
     * @constructor
     * @memberOf ui
     * @param {Object} option 参数对象
     * {
     * title: text,
     * text: &#x27;&#x27;,
     * link: &#x27;javascript:void(0);&#x27;,
     * icon: null,
     * onClick: null 
     * }
     * icon 为object, 包括{url,className,style}其中一个
     * onClick的回调参数为event, contextMenuItem
     * @example 
     *  //item instanceOf ContextMenuItem
     * var onClick = function(event, item){
     * }
     * 
     * @since version 1.0
     * @description
     */
    var ContextMenuItem = J.ui.ContextMenuItem = new J.Class(
    /**
     * @lends ui.ContextMenuItem.prototype
     */
    {
        /**
         * @ignore
         */
        init: function (opt){
            var option = {
                title: opt.title || opt.text || &#x27;&#x27;,
                text: opt.text || &#x27;&#x27;,
                link: opt.link || &#x27;javascript:void(0);&#x27;,
                icon: opt.icon || null,
                enable: typeof(opt.enable)===&#x27;undefined&#x27; ? true : opt.enable,
                onClick: opt.onClick || null,
                argument: opt.argument
            };
            
            this.option = option;
            this.parentMenu = opt.parentMenu;
            
            var liNode = this._el = $D.node(&#x27;li&#x27;, {
                &#x27;class&#x27;: &#x27;context_menu_item_container&#x27;
            });
            this.render();
            if(option.enable){
                this.enable();
            }else{
                this.disable();
            }
            var onClickFunc, context = this;
            if(option.onClick){
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                    if(context._isEnable){
                        option.onClick.call(this, e, context, context.parentMenu);
                    }
                }
            }else{
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                }
            }
            $E.on(liNode, &#x27;click&#x27;, onClickFunc);
        },
        /**
         * 设置菜单项的文本
         * @param {Object} text
         */
        setText: function(text, title){
            this.option.text = text;
            this.option.title = title || text;
            this.render();
        },
        /**
         * 设置菜单项的图标
         * @param {Object} icon
         *  { style, url, className }
         */
        setIcon: function(icon){
            this.option.icon = icon;
            this.render();
        },
        /**
         * 绘制菜单项的内容
         */
        render: function(){
            var option = this.option;
            var html = &#x27;&lt;a class=&quot;context_menu_item&quot; href=&quot;&#x27; + option.link + &#x27;&quot; title=&quot;&#x27; + option.title + &#x27;&quot;&gt;&#x27;;
            if(option.icon){
                var icon = option.icon,
                    image = icon.url ? &#x27;background-image: url(&#x27; + icon.url + &#x27;);&#x27; : &#x27;&#x27;,
                    style = (icon.style || &#x27;&#x27;) + image,
                    cls = icon.className || &#x27;&#x27;;
                html += &#x27;&lt;span class=&quot;context_menu_item_icon &#x27;+ cls +&#x27;&quot; style=&quot;&#x27; + style + &#x27;&quot;&gt;&lt;/span&gt;&#x27;;
            }
            html += &#x27;&lt;span class=&quot;context_menu_item_text&quot;&gt;&#x27; + option.text + &#x27;&lt;/span&gt;&#x27;;

            html += &#x27;&lt;/a&gt;&#x27;;
            this._el.innerHTML = html;
        },
        /**
         * 获取菜单项的dom
         * @return {HTMLElement} 
         */
        getElement: function(){
            return this._el;
        },
        /**
         * 显示该菜单项
         */
        show: function(){
            $D.show(this._el);
        },
        /**
         * 隐藏该菜单项
         */
        hide: function(){
            $D.hide(this._el);
        },
        /**
         * 禁用菜单项
         */
        disable: function(){
            this._isEnable = false;
            $D.addClass(this._el, &#x27;context_menu_item_disable&#x27;);
        },
        /**
         * 启用菜单项
         */
        enable: function(){
            this._isEnable = true;
            $D.removeClass(this._el, &#x27;context_menu_item_disable&#x27;);
        },
        /**
         * 销毁该菜单项
         */
        destory: function(){
            this._el.innerHTML = &#x27;&#x27;;
            $E.off(this._el, &#x27;click&#x27;);
            for (var p in this) {
                if (this.hasOwnProperty(p)) {
                    delete this[p];
                }
            }
        }
    });
    
    /**
     * 【FlashContextMenuItem】flash 菜单项,用于需要用到flash的时候,
     * 例如需要在右键菜单放置flash上传控件的时候
     * @see ui.ContextMenu
     * 
     * @class 
     * @name FlashContextMenuItem
     * @constructor
     * @memberOf ui
     * @param {Object} option 参数对象
     */
    var FlashContextMenuItem = J.ui.FlashContextMenuItem = new J.Class(
    /**
     * @lends ui.FlashContextMenuItem.prototype
     */
    {
        /**
         * @ignore
         */
        init: function (opt){
            //TODO hard code flash上传按钮环境
            var option = {
                title: opt.title || opt.text || &#x27;&#x27;,
                text: opt.text || &#x27;&#x27;,
                link: opt.link || &#x27;javascript:void(0);&#x27;,
                icon: opt.icon || null,
                enable: typeof(opt.enable)===&#x27;undefined&#x27; ? true : opt.enable,
                onClick: opt.onClick || null,
                folderId: opt.folderId || -1, //右键所属的文件夹：特殊id desktop:-1,explorer:-2
                argument: opt.argument
            };
            
            this.option = option;
            this.parentMenu = opt.parentMenu;
            
            var liNode = this._el = $D.node(&#x27;li&#x27;, {
                &#x27;class&#x27;: &#x27;context_menu_item_container&#x27;
            });
                
            var flashLiNode = this._flashLi = $D.node(&#x27;li&#x27;, {
                &#x27;class&#x27;: &#x27;context_menu_item_container&#x27;
            });
            
            var itemId = this._itemId = &#x27;context_menu_flashItem_&#x27; + (++flashItemId);
            var flashUlNode = this._flashUl = $D.node(&#x27;ul&#x27;, {
                &#x27;id&#x27;: itemId,
                &#x27;class&#x27;: &#x27;context_menu_item_list context_menu_flashitem_item&#x27;
            });
            flashItemHash[flashItemId] = flashUlNode;
            flashUlNode.appendChild(flashLiNode);
            this.render();
            document.body.appendChild(flashUlNode);
            if(option.enable){
                this.enable();
            }else{
                this.disable();
            }
            var onClickFunc, context = this;
            if(option.onClick){
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                    if(context._isEnable){
                        option.onClick.call(this, e, context, context.parentMenu);
                    }
                }
            }else{
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                }
            }
            $E.on(liNode, &#x27;click&#x27;, onClickFunc);
            
            var context = this;
            var observer = {
                /**
                 * @ignore
                 */
                onShow: function(opt){
                    var xy = $D.getClientXY(context._el);
                    var offsetX = 0,
                        offsetY = 0;
                    if(J.browser.ie){
                        offsetX = 2;
                        offsetY = 2;
                        if(J.browser.ie == 6 || J.browser.ie == 7){
                            offsetY = 1;
                        }
                    }
                    $D.setXY(context._flashUl, xy[0] + offsetX + &#x27;px&#x27;, xy[1] + offsetY + &#x27;px&#x27;);
                    $D.setStyle(context._flashUl, &#x27;width&#x27;, $D.getClientWidth(context._el) + &#x27;px&#x27;);
                    $D.setStyle(context._flashUl, &#x27;height&#x27;, $D.getClientHeight(context._el) + &#x27;px&#x27;);
                    $D.setStyle(context._flashUl, &#x27;zIndex&#x27;, context.parentMenu.getZIndex() + 1);
                    if(alloy.portal.getLoginLevel() &gt; 1 &amp;&amp; alloy.storage.getDefaultDisk()){
                        context._flashUploader.showFileSelector();
                    }else{
                        context._flashUploader.hideFileSelector();
                    }
                },
                /**
                 * @ignore
                 */
                onHide: function(opt){
                    $D.setXY(context._flashUl, 0, 0);
                    $D.setStyle(context._flashUl, &#x27;width&#x27;, &#x27;1px&#x27;);
                    $D.setStyle(context._flashUl, &#x27;height&#x27;, &#x27;1px&#x27;);
                }
            };
            $E.addObserver(this.parentMenu, &#x27;onShow&#x27;, observer.onShow);
            $E.addObserver(this.parentMenu, &#x27;onHide&#x27;, observer.onHide);
        },
        /**
         * 未实现
         */
        setText: function(text, title){
        },
        /**
         * 未实现
         */
        setIcon: function(icon){
        },
        /**
         * 绘制菜单项
         */
        render: function(){
            var option = this.option;
            var elHtml = &#x27;&lt;a class=&quot;context_menu_item&quot; href=&quot;&#x27; + option.link + &#x27;&quot;&gt;&lt;/a&gt;&#x27;;
            this._el.innerHTML = elHtml;
            
            var html = &#x27;&lt;a class=&quot;context_menu_item&quot; href=&quot;&#x27; + option.link + &#x27;&quot; title=&quot;&#x27; + option.title + &#x27;&quot;&gt;&#x27;;
            if(option.icon){
                var icon = option.icon,
                    image = icon.url ? &#x27;background-image: url(&#x27; + icon.url + &#x27;);&#x27; : &#x27;&#x27;,
                    style = (icon.style || &#x27;&#x27;) + image,
                    cls = icon.className || &#x27;&#x27;;
                html += &#x27;&lt;span class=&quot;context_menu_item_icon &#x27;+ cls +&#x27;&quot; style=&quot;&#x27; + style + &#x27;&quot;&gt;&lt;/span&gt;&#x27;;
            }
            html += &#x27;&lt;div class=&quot;explorer_upload_holder2&quot; style=&quot;padding:0 5px&quot;&gt;&lt;/div&gt;&#x27;;
            html += &#x27;&lt;/a&gt;&#x27;;
            this._flashLi.innerHTML = html;
            
            var holder = $D.mini(&#x27;.explorer_upload_holder2&#x27;, this._flashLi)[0];
            var opt = {
                callback:&#x27;alloy.flashUploadManager.flashEventListener&#x27;,
                mode: 0,
                autoshow: false,
                holder: holder,
                text: &#x27;&lt;span class=&quot;context_menu_item_text&quot;&gt;&#x27; + option.text + &#x27;&lt;/span&gt;&#x27;,
                width: &#x27;100%&#x27;,
                height: &#x27;100%&#x27;,
                extInfo: &#x27;{&quot;folderId&quot;:&#x27;+ this.option.folderId +&#x27;}&#x27;
            }
            this._flashUploader = new alloy.flashUploadManager.FlashUploader(opt);
            
            $D.setXY(this._flashUl, 0, 0);
            $D.setStyle(this._flashUl, &#x27;width&#x27;, &#x27;1px&#x27;);
            $D.setStyle(this._flashUl, &#x27;height&#x27;, &#x27;1px&#x27;);
        },
        /**
         * 获取菜单项的dom
         * @return {HTMLElement}
         */
        getElement: function(){
            return this._el;
        },
        /**
         * 显示
         */
        show: function(){
            $D.show(this._el);
        },
        /**
         * 隐藏
         */
        hide: function(){
            $D.hide(this._el);
        },
        /**
         * 禁用
         */
        disable: function(){
            this._isEnable = false;
            $D.addClass(this._el, &#x27;context_menu_item_disable&#x27;);
        },
        /**
         * 启用
         */
        enable: function(){
            this._isEnable = true;
            $D.removeClass(this._el, &#x27;context_menu_item_disable&#x27;);
        },
        /**
         * 销毁
         */
        destory: function(){
            this._el.innerHTML = &#x27;&#x27;;
            this._flashUl.innerHTML = &#x27;&#x27;;
            document.body.removeChild(this._flashUl);
            $E.off(this._el, &#x27;click&#x27;);
            for (var p in this) {
                if (this.hasOwnProperty(p)) {
                    delete this[p];
                }
            }
        }
    });
    
    /**
     * @static
     * @function
     * @name getItem
     * @memberOf ui.FlashContextMenuItem
     * @return {HTMLElement},{Null}
     */
    FlashContextMenuItem.getItem = function(id){
        return flashItemHash[id];
    };
    
    /**
     * 【ContextMenuSeparator】菜单项分隔符
     * @see ui.ContextMenu
     * 
     * @class 
     * @name ContextMenuSeparator
     * @constructor
     * @memberOf ui
     * @param {Object} option 参数对象
     */
    var ContextMenuSeparator = J.ui.ContextMenuSeparator = new J.Class(
    /**
     * @lends ui.ContextMenuSeparator.prototype
     */
    {
        /**
         * @ignore
         */
        init: function (option){
            var html = &#x27;&lt;span class=&quot;context_menu_separator&quot;&gt;&lt;/span&gt;&#x27;;
            var liNode = this._el = $D.node(&#x27;li&#x27;, {
                &#x27;class&#x27;: &#x27;context_menu_separator_container&#x27;
            });
            liNode.innerHTML = html;
        },
        /**
         * 获取分隔符的dom
         */
        getElement: function(){
            return this._el;
        },
        /**
         * 显示
         */
        show: function(){
            $D.show(this._el);
        },
        /**
         * 隐藏
         */
        hide: function(){
            $D.hide(this._el);
        },
        /**
         * 销毁
         */
        destory: function(){
            this._el.innerHTML = &#x27;&#x27;;
            for (var p in this) {
                if (this.hasOwnProperty(p)) {
                    delete this[p];
                }
            }
        }
    });
    /**
     * 【ContextSubmenuItem】子菜单项, 关联着一个子菜单
     * 
     * @class 
     * @name ContextSubmenuItem
     * @extends  ui.ContextMenuItem
     * @constructor
     * @memberOf ui
     * @param {Object} option 参数对象
     * {
     * title: text,
     * text: &#x27;&#x27;,
     * link: &#x27;javascript:void(0);&#x27;,
     * icon: null,
     * items: null,//子菜单的菜单项, 必选项
     * subWidth: null,//子菜单的宽
     * subContainer: null //子菜单的容器
     * }
     * icon 为object, 包括{url,className,style}其中一个
     * 
     * @since version 1.0
     * @description
     */
    var ContextSubmenuItem = J.ui.ContextSubmenuItem = new J.Class({extend: ContextMenuItem}, 
    /**
     * @lends ui.ContextSubmenuItem.prototype
     */
    {
        /**
         * @ignore
         */
        init: function (option){
            if(!option.items){
                throw new Error(&#x27;J.ui.ContextSubmenuItem: option.items is null!&#x27;);
            }
            option.title = option.title || option.text || &#x27;&#x27;;
            var defaultOption = {
                title: null,
                text: &#x27;&#x27;,
                autoHide: true,
                link: &#x27;javascript:void(0);&#x27;,
                icon: null,
                enable: true,
                subWidth: null,
                parentMenu: option.parentMenu
            };
            delete option.parentMenu;//不删除的话, extend会导致parentMenu指针不对
            option = this.option = J.extend(defaultOption, option);
            this.parentMenu = option.parentMenu;
            var liNode = this._el = $D.node(&#x27;li&#x27;, {
                &#x27;class&#x27;: &#x27;context_menu_item_container&#x27;
            });
            this.render();
            if(option.enable){
                this.enable();
            }else{
                this.disable();
            }
            var subOption = {
                parentMenu: option.parentMenu,
                width: option.subWidth,
                beforeShow: option.beforeShow,
                items: option.items
            };
            this._submenu = new ContextMenu(subOption);
                
            var onClickFunc, context = this;
            
            var submenuTimer = context.sunmenuTimer = 0, submenuHideTimeout = 200;
            /**
             * @ignore
             */
            var hideSubmenu = function(){
                if(context._submenu.isShow()){
                    context._submenu.hide();
                }
            };
            var observer = {
                /** @ignore */
                onItemMouseenter: function(e){
                    e.stopPropagation();
                    if(context._isEnable){
                        var xy = $D.getClientXY(this);
                        context._submenu.setZIndex(context.parentMenu.getZIndex());
                        context._submenu.show(xy[0], xy[1], 0, this);
                    }
                },
                /** @ignore */
                onItemMouseleave: function(e){
                    if(submenuTimer){
                        window.clearTimeout(submenuTimer);
                        submenuTimer = 0;
                    }
                    submenuTimer = window.setTimeout(hideSubmenu, submenuHideTimeout);
                },
                /** @ignore */
                onSubmenuMouseenter: function(e){
                    if(submenuTimer){
                        window.clearTimeout(submenuTimer);
                        submenuTimer = 0;
                    }
                    $D.addClass(liNode, &#x27;context_menu_item_hover&#x27;);
                },
                /** @ignore */
                onSubmenuMouseleave: function(e){
                    observer.onItemMouseleave(e);
                    //$D.removeClass(liNode, &#x27;context_menu_item_hover&#x27;);
                },
                /** @ignore */
                onSubmenuShow: function(){
                    $D.addClass(liNode, &#x27;context_menu_item_hover&#x27;); 
                },
                /** @ignore */
                onSubmenuHide: function(){
                    $D.removeClass(liNode, &#x27;context_menu_item_hover&#x27;);
                }
            };
            
            var submenuEl = context._submenu.getElement();
            $E.on(liNode, &#x27;mouseenter&#x27;, observer.onItemMouseenter);
            if(option.autoHide){
                $E.on(liNode, &#x27;mouseleave&#x27;, observer.onItemMouseleave);
                $E.on(submenuEl, &#x27;mouseenter&#x27;, observer.onSubmenuMouseenter);
                $E.on(submenuEl, &#x27;mouseleave&#x27;, observer.onSubmenuMouseleave);
            }
            //$E.addObserver(context._submenu, &#x27;onShow&#x27;, observer.onSubmenuShow);
            $E.addObserver(context._submenu, &#x27;onHide&#x27;, observer.onSubmenuHide);
            if(option.onClick){
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                    if(context._isEnable){
                        option.onClick.call(this, e, context);
                        observer.onItemMouseenter.call(this, e);
                    }
                }
            }else{
                /**
                 * @ignore
                 */
                onClickFunc = function(e){
                    e.preventDefault();
                    observer.onItemMouseenter.call(this, e);
                }
            }
            $E.on(liNode, &#x27;click&#x27;, onClickFunc);
        },
        /**
         * 获取该菜单项关联的子菜单
         */
        getSubmenu: function(){
            return this._submenu;
        },
        /**
         * 绘制菜单项的内容
         */
        render: function(){
            var option = this.option;
            var html = &#x27;&lt;a class=&quot;context_menu_item&quot; href=&quot;&#x27; + option.link + &#x27;&quot; title=&quot;&#x27; + option.title + &#x27;&quot;&gt;&#x27;;
            if(option.icon){
                var icon = option.icon,
                    image = icon.url ? &#x27;background-image: url(&#x27; + icon.url + &#x27;);&#x27; : &#x27;&#x27;,
                    style = (icon.style || &#x27;&#x27;) + image,
                    cls = icon.className || &#x27;&#x27;;
                html += &#x27;&lt;span class=&quot;context_menu_item_icon &#x27;+ cls +&#x27;&quot; style=&quot;&#x27; + style + &#x27;&quot;&gt;&lt;/span&gt;&#x27;;
            }
            html += &#x27;&lt;span class=&quot;context_menu_item_text&quot;&gt;&#x27; + option.text + &#x27;&lt;/span&gt;&lt;span class=&quot;context_menu_item_subicon&quot;&gt;&lt;/span&gt;&lt;/a&gt;&#x27;;
            this._el.innerHTML = html;
        }
    });
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
